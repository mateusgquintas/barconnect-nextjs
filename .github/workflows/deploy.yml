name: Deploy - Production (Vercel)

on:
  push:
    branches: [ master ]

jobs:
  trigger-vercel-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Vercel Production Deploy Hook
        env:
          VERCEL_DEPLOY_HOOK_PROD: ${{ secrets.VERCEL_DEPLOY_HOOK_PROD }}
        run: |
          if [ -z "$VERCEL_DEPLOY_HOOK_PROD" ]; then
            echo "Missing VERCEL_DEPLOY_HOOK_PROD secret in GitHub → Settings → Secrets and variables → Actions" >&2
            exit 1
          fi
          echo "Triggering Vercel Production deploy via Deploy Hook..."
          http_code=$(curl -s -o /tmp/resp.json -w "%{http_code}" -X POST "$VERCEL_DEPLOY_HOOK_PROD" -H "Accept: application/json" -d '{}')
          echo "HTTP $http_code"
          cat /tmp/resp.json || true
          if [ "$http_code" -lt 200 ] || [ "$http_code" -ge 300 ]; then
            echo "Deploy hook call failed." >&2
            exit 1
          fi
          echo "Deploy hook triggered successfully."
